<!DOCTYPE html>
<html>
<head>
  <title>Chat app demo</title>
</head>
<body>

  <form id="message-form">
    <label>Username</label><input name="username" />
    <label>Message</label><input name="message" />
    <button type="submit">Send</button>
  </form>

  <div>
    <h4>Past Messages</h4>
    <div id="message-list" />
  </div>
  <script src="/scripts/jquery" type="text/javascript"></script>
  <script type="text/javascript">
    $( document ).ready(function() {
      $('#message-form').on('submit', function(event) {
        event.preventDefault()

        var userInput = {
          username: event.target.username.value,
          message: event.target.message.value
        }

        $.post('/messages', JSON.stringify(userInput), function() {

          $.get('/messages', function(data) {
            data = JSON.parse(data)
            var messagesArray = data.messages.map((m) => {
              var $message = $('<div></div>')
              var $username = $('<span class="username"/>')
              var $text = $('<span class="message-text"/>')
              $username.text(m.username)
              $text.text(m.message)
              $message.append($username, ': ', $text)
              return $message
            })
            $('#message-list').empty()
            $('#message-list').append(messagesArray.reverse())

          })
        })

      })
      $.get('/messages', function(data) {
        data = JSON.parse(data)
        var messagesArray = data.messages.map((m) => {
          var $message = $('<div></div>')
          var $username = $('<span class="username"/>')
          var $text = $('<span class="message-text"/>')
          $username.text(m.username)
          $text.text(m.message)
          $message.append($username, ': ', $text)
          return $message
        })
        $('#message-list').empty()
        $('#message-list').append(messagesArray.reverse())

      })
    })
  </script>

</body>
</html>